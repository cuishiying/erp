<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <title>安全风险管控</title>
    <link rel="stylesheet" th:href="@{/static/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/static/css/layout.css}">
    <link rel="stylesheet" th:href="@{/static/css/jquery.datetimepicker.css}">

    <style type="text/css">
        .form-inline .item-content{
            width: 500px;
        }
        .form-inline{
            margin: 5px;
        }
        .table{
            table-layout: fixed;
        }
        .td-ellipsis{
            overflow:hidden;
            white-space:nowrap;
            text-overflow:ellipsis;
        }
        .header-item{
            float: left;
            margin-bottom: 7px;
            margin-top: 5px;
            margin-right: 50px;
        }
        .head-table tr>td{
            width: 50%;
        }
        .head-table .head-table-body td{
            border-top: 0px;
        }
        .head-table-body input{
            border-left-width:0px;
            border-top-width:0px;
            border-right-width:0px;
            border-bottom-width:1px;
            border-bottom-color:black;
            outline:none;
            width: 80%;
        }
        .td-input>textarea,input{
            border-color:#fff;
            box-shadow: none;
            border-left-width:0px;
            border-top-width:0px;
            border-right-width:0px;
            border-bottom-width:0px;
            outline:none;
            width: 100%;
        }
        .risk-handle img{
            margin-left: 20px;
        }
        .risk-handle  .td-control{
            vertical-align: middle !important;
        }
        .panel .panel-body .table>tbody>tr>td{
            border-top: none;
        }
        .table-fix .table-content-center{
            vertical-align: middle;
            text-align: center;
            border-bottom: 1px solid #333;
        }
    </style>

</head>
<body>
<div id="wrapper">
    <div class="row">
        <div class="col-md-12">
            <div class="panel">
                <div class="panel-heading">
                    <h3 class="panel-title">风险录入</h3>
                </div>
                <div class="panel-body">

                    <table class="table head-table">
                        <tbody class="head-table-body">
                            <tr class="item-content " name="riskItem">
                                <td  class="td-ellipsis">
                                    <label for="riskElement">危险因素:&nbsp;&nbsp;</label>
                                    <input type="text" class="riskElement" id="riskElement">
                                </td>
                                <td  class="td-ellipsis">
                                    <label for="riskDesc">风险描述:&nbsp;&nbsp;</label>
                                    <input type="text" class="riskDesc" id="riskDesc">
                                </td>
                            </tr>
                            <tr class="item-content " name="riskItem">
                                <td  class="td-ellipsis">
                                    <label for="riskAddr">风险地点:&nbsp;&nbsp;</label>
                                    <input type="text" class="riskAddr" id="riskAddr">
                                </td>
                                <td  class="td-ellipsis">
                                    <label for="riskLevel">级别:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                    <input type="text" class="riskLevel" id="riskLevel">
                                </td>
                            </tr>
                            <tr class="item-content " name="riskItem">
                                <td  class="td-ellipsis">
                                    <label for="riskDept">责任单位:&nbsp;&nbsp;</label>
                                    <input type="text" class="riskDept" id="riskDept">
                                </td>
                                <td  class="td-ellipsis">
                                    <label for="responsible">责任人:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                    <input type="text" class="responsible" id="responsible">
                                </td>
                            </tr>
                            <tr class="item-content" name="riskItem">
                                <td  class="td-ellipsis">
                                    <label for="branchLeader">矿分管领导:</label>
                                    <input type="text" class="branchLeader" id="branchLeader">
                                </td>
                                <td  class="td-ellipsis">
                                    <label for="orgLeader">组织领导:&nbsp;&nbsp;</label>
                                    <input type="text" class="orgLeader" id="orgLeader">
                                </td>
                            </tr>
                            <tr class="item-content " name="riskItem">
                                <td  class="td-ellipsis">
                                    <label for="handleTimeLimit">时限:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                    <input type="text" class="handleTimeLimit" id="handleTimeLimit">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="table-responsive">
                        <table border="1" cellpadding="10" width="100%" class="table table-fix table-layout" >
                        <thead>
                            <tr>
                                <th class="text-center table-content-center" style="width: 50%">管控措施</th>
                                <th class="text-center table-content-center" style="width: 40%">管控措施落实情况</th>
                                <th class="text-center table-content-center" style="width: 10%">操作</th>
                            </tr>
                        </thead>
                        <tbody class="risk-handle">
                            <tr class="item-content" name="riskItem">
                                <td  class="td-ellipsis text-center td-input">
                                    <textarea type="text" class="content precaution" spellcheck="false"></textarea>
                                </td>
                                <td  class="td-ellipsis text-center td-input">
                                    <textarea type="text" class="content handleResult" spellcheck="false"></textarea>
                                </td>
                                <td  class="td-ellipsis td-control">
                                    <img th:src="@{/static/img/icon-mark-normal.png}" alt="" style="width: 20px;height: 20px" class="item-mark warming" value="false">
                                    <img th:src="@{/static/img/add.png}" alt="" style="width: 20px;height: 20px" class="item-add">
                                </td>
                            </tr>
                            <tr class="hidden item-model" name="riskItem">
                                <td  class="td-ellipsis text-center td-input">
                                    <textarea type="text" class="content precaution" spellcheck="false"></textarea>
                                </td>
                                <td  class="td-ellipsis text-center td-input">
                                    <textarea type="text" class="content handleResult" spellcheck="false"></textarea>
                                </td>
                                <td  class="td-ellipsis td-control">
                                    <img th:src="@{/static/img/icon-mark-normal.png}" alt="" style="width: 20px;height: 20px" class="item-mark warming" value="false">
                                    <img th:src="@{/static/img/delete.png}" alt="" style="width: 20px;height: 20px;" class="item-delete">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-12 text-center" style="margin-top: 10px">
                            <button type="button" class="btn btn-success save">保存</button>
                            <button type="button" class="btn btn-danger" onclick="javascript:history.go(-1);">取消</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:src="@{/static/js/jquery.min.js}"></script>
<script th:src="@{/static/js/bootstrap.min.js}"></script>
<script th:src="@{/static/js/jquery.datetimepicker.full.js}"></script>
<script th:src="@{/static/js/laydate.js}"></script>
<script th:src="@{/static/utils/fetchUtils.js}"></script>
<script th:src="@{/static/utils/httpUtils.js}"></script>
<script th:src="@{/static/utils/dateUtils.js}"></script>
<script th:src="@{/static/utils/strUtils.js}"></script>
<script type="text/javascript" th:inline="javascript">
    var ctx = /*[[@{/}]]*/;
    $(".item-add").on('click',function () {
        $(".item-model").before("<tr class='item-content' name='riskItem'>"+$(".item-model").html()+"</tr>");
    });
    $(document).on('click','.item-delete',function() {
        if ($(".risk-handle tr").size() == 2) {
            alert("无法删除，至少包含一个选项");
        }else{
            $(this).parent().parent().remove();
        }
    });
    $(document).on('click','.item-mark',function () {
        var img = strUtils.splitImg($(this));
        if('icon-mark-normal.png'==img){
            $(this).attr('src','/static/img/icon-mark.png');
            $(this).attr('value',true);
        }else{
            $(this).attr('src','/static/img/icon-mark-normal.png');
            $(this).attr('value',false);
        }
    });

    $(".save").click(function () {
        var risk = new Object();
        risk.riskElement = $(".riskElement").val();
        risk.riskDesc = $(".riskDesc").val();
        risk.riskAddr = $(".riskAddr").val();
        risk.riskLevel = $(".riskLevel").val();
        risk.riskDept = $(".riskDept").val();
        risk.responsible = $(".responsible").val();
        risk.branchLeader = $(".branchLeader").val();
        risk.orgLeader = $(".orgLeader").val();
        risk.handleTimeLimit = $(".handleTimeLimit").val();
        risk.riskHandles = new Array();

        $(".risk-handle .item-content").each(function (e) {
            var riskHandle = new Object();
            riskHandle.precaution = $(this).find(".precaution").val().trim();
            riskHandle.handleResult = $(this).find(".handleResult").val().trim();
            riskHandle.warming = $(this).find(".warming ").attr('value')=='true'?true:false;
            risk.riskHandles.push(riskHandle);
        });
        if(!risk.riskElement){
            return;
        }
        $.postJson(ctx+"risk/value/add",risk,function (e) {
            if(e.success){
                window.location.href = ctx+"risk/value/list";
            }else{
                alert(e.message);
            }
        })
    });

</script>

</body>
</html>