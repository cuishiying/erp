<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>隐患排查</title>
    <link rel="stylesheet" th:href="@{/static/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/static/css/layout.css}">
    <link rel="stylesheet" th:href="@{/static/css/jquery.datetimepicker.css}">
    <style type="text/css">
        .item-name{
            display: inline-block;
            min-width: 100px;
        }

        .form-inline .item-content{
            width: 500px;
        }
        .form-inline{
            margin: 5px;
        }
        .table{
            table-layout: fixed;
        }
        .td-ellipsis{
            overflow:hidden;
            white-space:nowrap;
            text-overflow:ellipsis;
        }
        .header-item{
            float: left;
            margin-bottom: 7px;
            margin-top: 5px;
            margin-right: 50px;
        }
    </style>
</head>
<body>
<div id="wrapper">
    <!--<nav th:replace="common/fragment :: sidebar"></nav>-->
    <div class="main">
        <div class="main-content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title">山西铺龙湾煤业有限公司隐患排查治理“五定”落实表</h3>
                            </div>

                            <div class="panel-body">
                                <div>
                                    <div class="header-item">
                                        <label for="pitName">矿井名称:</label>
                                        <input type="text" class="pitName" id="pitName" style="border-left-width:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:1px;border-bottom-color:black;outline:none;">
                                    </div>
                                    <div class="header-item">
                                        <label for="leader">分矿领导签字:</label>
                                        <input type="text" class="pitName" id="leader" style="border-left-width:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:1px;border-bottom-color:black;outline:none;">
                                    </div>
                                    <div class="header-item createTime" style="float: right">

                                    </div>
                                </div>
                                <table class="table table-striped table-bordered">
                                    <thead>
                                    <tr class="text-center">
                                        <th class="text-center" style="width: 5%">序号</th>
                                        <th class="text-center" style="width: 5%">专业</th>
                                        <th class="text-center" style="width: 5%">隐患等级</th>
                                        <th class="text-center" style="width: 13%">隐患内容</th>
                                        <th class="text-center" style="width: 15%">整改措施</th>
                                        <th class="text-center" style="width: 5%">承办单位</th>
                                        <th class="text-center" style="width: 10%">完成时间</th>
                                        <th class="text-center" style="width: 5%">责任人</th>
                                        <th class="text-center" style="width: 5%">治理资金</th>
                                        <th class="text-center" style="width: 10%">治理预案</th>
                                        <th class="text-center" style="width: 10%">验收时间</th>
                                        <th class="text-center" style="width: 5%">验收人</th>
                                        <th class="text-center" style="width: 8%">操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr class="item-content" name="hiddenTroubleItem">
                                        <td  class="td-ellipsis text-center order">
                                            1
                                            <!--<input type="text" class="form-control order" style="height: 25px" value="1">-->
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control majors" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <select class="select_two_box grade" name="grades" id="grades">
                                                <!--<option value="">请选择</option>-->
                                                <option th:each="g:${grades}" th:value="${g?.toString()}" th:text="${g.name}"></option>
                                            </select>
                                            <!--<input type="text" class="form-control grade" style="height: 25px">-->
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control content" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control actions" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control undertakeUnit" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control finishTime date" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control responsiblePerson" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control controllingMoney" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control managementPlan" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control acceptanceTime date" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control acceptancepeople" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis">
                                            <img th:src="@{/static/img/delete.png}" alt="" style="width: 20px;height: 20px" class="">
                                            <img th:src="@{/static/img/add.png}" alt="" style="width: 20px;height: 20px" class="item-add">
                                        </td>
                                    </tr>
                                    <tr class="hidden item-model" name="hiddenTroubleItem">
                                        <td  class="td-ellipsis text-center order">
                                            <!--<input type="text" class="form-control order" style="height: 25px">-->
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control majors" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <select class="select_two_box grade" name="grades" id="grades">
                                                <!--<option value="">请选择</option>-->
                                                <option th:each="g:${grades}" th:value="${g?.toString()}" th:text="${g.name}"></option>
                                            </select>
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control content" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control actions" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control undertakeUnit" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control finishTime date" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control responsiblePerson" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control controllingMoney" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control managementPlan" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control acceptanceTime date" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis text-center">
                                            <input type="text" class="form-control acceptancepeople" style="height: 25px">
                                        </td>
                                        <td  class="td-ellipsis">
                                            <img th:src="@{/static/img/delete.png}" alt="" style="width: 20px;height: 20px" class="item-delete">
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div>
                                    <div class="header-item">
                                        <label for="rummager">检查人:</label>
                                        <input type="text" class="pitName" id="rummager" style="border-left-width:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:1px;border-bottom-color:black;outline:none;">
                                    </div>
                                    <div class="header-item" style="text-align: center">
                                        <label for="organizationMan">组织人:</label>
                                        <input type="text" class="pitName" id="organizationMan" style="border-left-width:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:1px;border-bottom-color:black;outline:none;">
                                    </div>
                                    <div class="header-item">
                                        <label for="entryPerson">填表人:</label>
                                        <input type="text" class="pitName" id="entryPerson" style="border-left-width:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:1px;border-bottom-color:black;outline:none;">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-10 text-center" style="margin-top: 10px">
                                        <button type="button" class="btn btn-success save">保存</button>
                                        <button type="button" class="btn btn-danger" onclick="javascript:history.go(-1);">取消</button>
                                    </div>
                                </div>
                            </div>

                            <div class="panel-footer"></div>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>


</div>

<script th:src="@{/static/js/jquery.min.js}"></script>
<script th:src="@{/static/js/bootstrap.min.js}"></script>
<script th:src="@{/static/js/jquery.datetimepicker.full.js}"></script>
<script th:src="@{/static/js/laydate.js}"></script>
<script th:src="@{/static/utils/httpUtils.js}"></script>
<script th:src="@{/static/utils/dateUtils.js}"></script>

<script type="text/javascript" th:inline="javascript">
    var ctx = /*[[@{/}]]*/;

    //执行一个laydate实例，时间控件
//    var loadLaydate = {} || loadLaydate;
//    loadLaydate.init = function (){
//        lay('.date').each(function(){
//            laydate.render({
//                elem: this,
//                trigger: 'click'
//            });
//        });
//    }

    $(document).on('click','.date',function () {
        $('.date').datetimepicker({
            lang:"ch", //语言选择中文 注：旧版本 新版方法：$.datetimepicker.setLocale('ch');
            format:"Y-m-d",      //格式化日期
            roundTime: 'round',
            timepicker:false,    //打开时间选项
            step:1,
            todayButton:false    //关闭选择今天按钮
        });

    })


    $(".item-add").on('click',function () {
//        console.log($(".item-model").html())
//        console.log(noEscapeHtml($(".item-model").html()))
        $(".item-model").before("<tr class='item-content' name='hiddenTroubleItem'>"+$(".item-model").html()+"</tr>");
//        loadLaydate.init();
        $(".item-content").each(function (i,e) {
            $(this).find(".order").html(i+1);
        });
    });

    $(document).on('click','.item-delete',function() {
        if ($("tbody tr").size() == 2) {
            alert("无法删除，至少包含一个选项");
        }else{
            $(this).parent().parent().remove();
            $(".item-content").each(function (i,e) {
                $(this).find(".order").html(i+1);
            });
        }
    });

    $(".save").click(function () {
        var hiddenTroubles = new Array();
        $("tbody .item-content").each(function (e) {
            var hiddenTrouble = new Object();
            hiddenTrouble.majors = $(this).find(".majors").val().trim();
            hiddenTrouble.grade = $(this).find(".grade").val().trim();
            hiddenTrouble.content = $(this).find(".content").val().trim();
            hiddenTrouble.actions = $(this).find(".actions").val().trim();
            hiddenTrouble.undertakeUnit = $(this).find(".undertakeUnit").val().trim();
            hiddenTrouble.finishTime = $(this).find(".finishTime").val().trim();
            hiddenTrouble.responsiblePerson = $(this).find(".responsiblePerson").val().trim();
            hiddenTrouble.controllingMoney = $(this).find(".controllingMoney").val().trim();
            hiddenTrouble.managementPlan = $(this).find(".managementPlan").val().trim();
            hiddenTrouble.acceptanceTime = $(this).find(".acceptanceTime").val().trim();
            hiddenTrouble.acceptancepeople = $(this).find(".acceptancepeople").val().trim();


            hiddenTrouble.pitName = $("#pitName").val().trim();
            hiddenTrouble.leader = $("#leader").val().trim();
            hiddenTrouble.createTime = $(".createTime").html();
            hiddenTrouble.rummager = $("#rummager").val().trim();
            hiddenTrouble.organizationMan = $("#organizationMan").val().trim();
            hiddenTrouble.entryPerson = $("#entryPerson").val().trim();

            hiddenTroubles.push(hiddenTrouble);
        });
        ajaxUtils.postJson(ctx+"hiddenTrouble/add",hiddenTroubles,function (e) {
            if(e.success){
                window.location.href = ctx+"hiddenTrouble/list";
            }else{
                alert(e.message);
            }
        })
    });
    
    $(function () {
        var nowTime= dateUtils.getToday();
        $(".createTime").html(nowTime);
    });

    function noEscapeHtml(html) {
        return html.replace(/(\&|\&)gt;/g, ">")
            .replace(/(\&|\&)lt;/g, "<")
            .replace(/(\&|\&)quot;/g, "\"");
    }


</script>
</body>
</html>