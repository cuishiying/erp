<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>隐患排查</title>
    <link rel="stylesheet" th:href="@{/static/css/bootstrap.css}">
    <link rel="stylesheet" th:href="@{/static/css/layout.css}">
    <link rel="stylesheet" th:href="@{/static/css/jquery.datetimepicker.css}">
    <link rel="stylesheet" th:href="@{/static/css/SimpleCanleder.css}">

    <style rel="stylesheet" type="text/css">
        .table-title{
            text-align: center;
        }
        .table-sub-title{
            height: 30px;
        }
        .table-date{
            float: right;
        }
        .table-fix{
            table-layout:fixed
        }
        .td-ellipsis{
            overflow:hidden;
            white-space:nowrap;
            text-overflow:ellipsis;
            text-align: center;
        }
        .table-fix .table-content-center{
            vertical-align: middle;
            text-align: center;
            border-bottom: 1px solid #333;
        }
        .table-fix td{
            height: 40px;
        }
        .table-fix .no-padding{
            padding: 0px;
        }
        .table-fix td{
            text-align: center;
        }
        .table-fix input{
            height: 25px;
        }
        .header-item{
            float: left;
            margin-bottom: 7px;
            margin-top: 5px;
            margin-right: 50px;
        }
        .panel .panel-body td input{
            border: none;
            box-shadow: none;
            -webkit-box-shadow: none;
        }
        .panel .panel-body .table>tbody>tr>td{
            border-top: none;
        }
    </style>
</head>
<body>
<div id="wrapper">
    <!--<nav th:replace="common/fragment :: sidebar"></nav>-->
    <div class="main">
        <div class="main-content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">

                        <div class="panel">
                            <!--<div class="panel-heading">-->
                            <!--<h3 class="panel-title">山西铺龙湾煤业有限公司隐患排查治理“五定”落实表</h3>-->
                            <!--</div>-->


                            <div class="panel-body">
                                <div>
                                    <a type="button" class="btn btn-primary btn-import noprint">导入</a>
                                    <form id="uploadForm" enctype="multipart/form-data" method="post" style="display: none">
                                        <input id="upfile" type="file" name="upfile" >
                                    </form>
                                    <a type="button" class="btn btn-primary btn-export noprint">导出</a>
                                    <button type="button" class="btn btn-primary btn-print noprint" onclick="javascript:window.print();">打印</button>
                                    <button type="button" class="btn btn-primary btn-toggle noprint">隐藏</button>
                                </div>
                                <!--startprint-->
                                <div class="print" >
                                    <h3 class="table-title">事故隐患排查治理登记台账</h3>
                                    <div class="table-sub-title">
                                        <form th:action="@{/hiddenTrouble/list/month}" method="get" class="month-query">
                                            <input type="text"  class="noprint" name="keyword" th:value="${queryDTO.keyword}" placeholder="类别" style="outline: none"/>
                                            <button type="button" class="btn-sm btn-primary btn-search noprint">查询</button>
                                            <!--<select class="queryType noprint" name="queryType">-->
                                                <!--<option value="">类别</option>-->
                                                <!--<option th:each="q:${queryTypes}"  th:text="${q?.name}" th:id="${q?.id}" th:value="${q?.name}" th:selected="${queryDTO!=null&&q.name==queryDTO.queryType}"></option>-->
                                            <!--</select>-->
                                            <input type="text" class="month-input table-date" name="queryDate" placeholder="请选择月份" style="width: 100px;outline: none" th:value="${#dates.format(queryDTO?.queryDate,'yyyy-MM')}">
                                        </form>
                                    </div>
                                    <div class="table-responsive">
                                        <table border="1" cellpadding="10" width="100%" class="table table-fix table-layout">
                                            <thead>
                                            <tr>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 2%">序<br>号</th>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 8%">排查地点</th>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 8%">排查<br>时间</th>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 5%">排查<br>人员</th>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 15%">存在的隐患及问题</th>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 5%">类别</th>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 5%">等级</th>
                                                <th colspan="6" class="table-content-center no-padding" scope="col" style="width: 30%">隐患整改“五落实”</th>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 5%">督办部<br>门/人员</th>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 8%">验收<br>时间</th>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 5%">验收部<br>门/人员</th>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 5%">整改结果</th>
                                                <th rowspan="2" class="table-content-center" scope="col" style="width: 5%">操作</th>
                                            </tr>

                                            <tr>
                                                <th colspan="2" class="table-content-center no-padding" scope="col" style="width: 14%">整改措施</th>
                                                <th class="table-content-center no-padding" scope="col" style="width: 2%">责任单位<br>/责任人</th>
                                                <th class="table-content-center no-padding" scope="col" style="width: 2%">资金</th>
                                                <th class="table-content-center no-padding" scope="col" style="width: 2%">时限</th>
                                                <th class="table-content-center no-padding" scope="col" style="width: 4%">预案</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr class="item-content" th:each="item:${page.content}">
                                                <td th:text="${item.orderNumber}"></td>
                                                <td th:text="${item.checkAddress}"></td>
                                                <td th:text="${item.checkTime}"></td>
                                                <td th:text="${item.checkPerson}"></td>
                                                <td th:text="${item.content}"></td>
                                                <td th:text="${item.type}"></td>
                                                <td th:text="${item.level}"></td>
                                                <td th:text="${item.actions}" colspan="2"></td>
                                                <td th:text="${item.responsiblePerson}"></td>
                                                <td th:text="${item.controllingMoney}"></td>
                                                <td th:text="${item.timeLimit}"></td>
                                                <td th:text="${item.managementPlan}"></td>
                                                <td th:text="${item.handlePerson}"></td>
                                                <td th:text="${item.acceptanceTime}"></td>
                                                <td th:text="${item.acceptancePeople}"></td>
                                                <td th:text="${item.result}" class="result"></td>
                                                <td>
                                                    <a class="btn-sm btn-success" th:href="@{/hiddenTrouble/month/update/}+${item?.id}" style="padding: 2px 4px;width: 35px;display: inline-block">修改</a>
                                                    <a class="btn-sm btn-danger delete" th:value="${item?.id}" style="padding: 2px 4px;width: 35px;display: inline-block">删除</a>
                                                </td>
                                            </tr>

                                            </tbody>

                                        </table>
                                    </div>
                                </div>
                                <!--endprint-->
                                <!--分页-->
                                <div class="noprint">
                                    <nav th:replace="common/page::paging"></nav>
                                </div>

                            </div>

                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>


</div>

<script th:src="@{/static/js/jquery.min.js}"></script>
<script th:src="@{/static/js/bootstrap.min.js}"></script>
<script th:src="@{/static/js/jquery.datetimepicker.full.js}"></script>
<script th:src="@{/static/js/SimpleCanleder.js}"></script>
<script th:src="@{/static/js/jquery.form.js}"></script>
<script th:src="@{/static/utils/fetchUtils.js}"></script>
<script th:src="@{/static/utils/dateUtils.js}"></script>

<script type="text/javascript" th:inline="javascript">
    var ctx = /*[[@{/}]]*/;
//    var types = /*[[${types}]]*/;
    $(".close-window").click(function (e) {
        window.history.go(-1);
    });

    $(".month-input").simpleCanleder();

    function preview() {
        var bdhtml=window.document.body.innerHTML;//获取当前页的html代码
        var startStr="<!--startprint-->";//设置打印开始区域
        var endStr="<!--endprint-->";//设置打印结束区域
        var printHtml=bdhtml.substring(bdhtml.indexOf(startStr)+startStr.length,bdhtml.indexOf(endStr));//从标记里获取需要打印的页面
        window.document.body.innerHTML=printHtml;//需要打印的页面
        window.print();
        window.document.body.innerHTML=bdhtml;//还原界面
        location.reload();
    }
    $(".btn-toggle").click(function () {
        if($(".table-fix td").hasClass("td-ellipsis")){
            $(".table-fix td").removeClass("td-ellipsis");
            $(this).html("隐藏");
        }else{
            $(".table-fix td").addClass("td-ellipsis");
            $(this).html("显示");
        }
    });

    //导入excel
    $(".btn-import").bind("click",function (e) {
        $(this).next().find("input[type='file']").trigger("click").unbind("change").bind("change",function () {
            if (!this.value) return;
            if(checkExcel()){
                $(this).parent().ajaxSubmit({
                    url: ctx + "hiddenTrouble/import",
                    type: "post",
                    beforeSend: function() {
                        console.log("准备上传");
                    },
                    success:function (result) {
                        if (result.success){
                            alert("上传成功");
                            history.go(0);
                        }else{
                            alert(result.message);
                        }
                    }, error: function(error) {
                        alert("出错啦");
                    }
                })
            }

        })
    });

    //JS校验form表单信息
    function checkExcel(){
        var fileDir = $("#upfile").val();
        var suffix = fileDir.substr(fileDir.lastIndexOf("."));
        console.log(suffix);
        if("" == fileDir){
            alert("选择需要导入的Excel文件！");
            return false;
        }
        if(".XLS" != suffix && ".XLSX" != suffix && ".xls" != suffix && ".xlsx" != suffix){
            alert("选择Excel格式的文件导入！");
            return false;
        }
        return true;
    }

    $('.btn-search').click(function () {
        $('.month-query').submit();
    });

    $('.btn-export').click(function () {
        window.location.href = ctx+'hiddenTrouble/export/month?queryDate='+$('.table-date').val()+'&queryType='+$('.queryType').find("option:selected").attr("value");
    });

    $(".delete").click(function () {
        $.postParams(ctx+"hiddenTrouble/month/delete/"+$(this).attr("value"),"",function (e) {
            if(e.success){
                alert(e.data);
                window.location.reload();
            }else{
                alert(e.message);
            }
        });
    });
    $(function () {
//        console.log(types);
        $("tbody .item-content").each(function (e) {
            if($(this).find(".result").html()=='未整改'){
                $(this).css('background','#ff4400');
            }
        });
    });


</script>
</body>
</html>